---
title: Predicting Wine Quality and Wine Type
author: Eric Leung
date: 2016 June 17th
output: 
  pdf_document: 
    fig_caption: yes
    fig_crop: no
    fig_height: 4
    fig_width: 5
    toc: yes
fontsize: 12pt
bibliography: refs.bib
classoption: twocolumn
---

```{r Knitr Options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

```{r Figure Titles}
figure1 <- paste("Heatmap of variable correlations for the red wine data.",
                 "There are noteworthy correlations between: fixed acidity",
                 "and citric acid; density and fixed acidity; and pH and",
                 "fixed acidity.",
                 "Overall, not very many strong correlations.")
figure2 <- paste("Heatmap of variable correlations for the white wine data",
                 "There are noteworthy correlations between density and",
                 "alcohol as well as residual sugar and density.")
figure3 <- paste("Heatmap of variable correlations for all wine data",
                 "After combining the two data sets, the correlation matrix",
                 "is less sparse and there appears to be strong correlations.",
                 "These correlations should be kept in mind while continuing",
                 "with the analysis.")
compareFixed <- paste("Density distributions of fixed acidity in white and red",
                      "wine. Here we see a strong overlap between the two",
                      "wines. This suggests that using fixed acidity to",
                      "differentiate between wines will be difficult.")
compareChloride <- "Density distributions of chlorides in white and red wine"
figure4 <- "Distribution of pH values for all wine data"
figure5 <- "Distribution of citric acid values for all wine data"
figure6 <- "Distribution of raw chloride values for all wine data"
figure7 <- paste("Distribution of the natural log transformation of chloride",
                 "values for all wine data")
figList <- c("figure1", "figure2", "figure3", "compareFixed", "compareChloride",
             "figure4", "figure5", "figure6", "figure7")
```

```{r Source Extenal Code}
source("../bin/splitdf.R")
source("../bin/naive-bayes.R")
source("../bin/decision-trees.R")
source("../bin/svm.R")
```

```{r Load Packages}
# Load packages
require(ggplot2)
require(dplyr)
require(corrplot)
require(cvTools)
```

```{r Source}
# Load data
red <- read.table(file = "../raw-data/winequality-red.csv",
                  header = TRUE,
                  stringsAsFactors = FALSE,
                  sep = ";") %>% tbl_df()
white <- read.table(file = "../raw-data/winequality-white.csv",
                    header = TRUE,
                    stringsAsFactors = FALSE,
                    sep = ";") %>% tbl_df()
```

# Abstract

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse tristique
tortor eget ipsum porttitor consequat. Cras varius quam dui, a suscipit diam
pellentesque ut. Aliquam malesuada elementum tellus, ac feugiat nulla. Phasellus
facilisis viverra consectetur. Donec ullamcorper hendrerit ultrices. Vestibulum
tempus mauris nec felis condimentum, a interdum tortor ullamcorper. Sed vel eros
mauris. Nulla laoreet hendrerit lacus, vel efficitur magna fringilla eu. Fusce
vestibulum sodales leo, at suscipit lectus. Maecenas eu ultricies erat, nec
porta purus.


# Introduction

```{r Format Data}
redType <- red %>% mutate(type = "red")
whiteType <- white %>% mutate(type = "white")
wines <- bind_rows(redType, whiteType)
randomizeRows <- sample(seq(1, nrow(wines)), nrow(wines))
wines <- wines[randomizeRows, ]
```


## Wine Dataset Description

I used the Wine Quality Data Set. This data comes from Dr. Paulo Cortez and
their pursuit to predict wine quality preferences [@cortez2009modeling]. The
data was downloaded from the UCI Machine Learning Repository [@lichman2013uci].

The data analyzed included two data sets, one related to red *vinho verde* and
the other related to white *vinho verde*. Each of the two data sets contain
twelve variables, one of which was the participant's quality score for that wine
[@lichman2013uci]. This analysis will use both data sets, either in one data set
or two separate data sets and focusing on one type of wine.


## Wine Characteristics

The red wine data set has `r nrow(red)` samples while the white wine data set
has `r nrow(white)` samples. It was not clear from the reference paper on how
they collected the data besides being tested "at the official certification
entity (CVRVV)" [@cortez2009modeling].

The available physicochemical variables are:

1. fixed acidity (g(tartaric acid)/dm^3^)
2. volatile acidity (g(acetic acid)/dm^3^)
3. citric acid (g/dm^3^)
4. residual sugar (g/dm^3^)
5. chlorides (g(sodium chloride)/dm^3^)
6. free sulfur dioxide (mg/dm^3^)
7. total sulfur dioxide (mg/dm^3^)
8. density (g/cm^3^)
9. pH
10. sulphates (g(potassium sulphate)/dm^3^)
11. alcohol (vol.%)

These variables will be used in the machine learning analysis.


# Exploratory Data Analysis

Before I go straight into implementing various machine learning algorithms,
I will take a look at the data. This will ensure there isn't anything too
anomalous. This can also affect how my results are interpreted.

## Correlations

```{r red, fig.cap=figure1}
redCorr <- redType %>% select(-type) %>% cor
redCorr %>% corrplot(type = "lower")
```

```{r white, fig.cap=figure2}
whiteCorr <- whiteType %>% select(-type) %>% cor
whiteCorr %>% corrplot(type = "lower")
```

```{r wines, fig.cap=figure3}
winesCorr <- wines %>% select(-type) %>% cor
winesCorr %>% corrplot(type = "lower")
```

Figures `r which(figList == "figure1")`, `r which(figList == "figure2")`, and
`r which(figList == "figure3")` show heat maps generated from correlation
matrices from just white wine data, just red wine data, and the combination of
both wines into one.


## Comparisons Between White and Red

In this report, I will be differentiating between red and white wine types.
Firstly, I will need to combine the two separate wine data sets. Here I will
explore potential issues in combining the data.

When combining the data, I will explore the distribution of each of the wine
attributes for both wines are similar. This compatibility between data sets will
lessen any bias or inherent structure in the data. Any underlying structure in
the combined data may give a machine learning algorithm information on
predicting wine type not found in the attributes.

```{r Compare Red/White Fixed Acidity, fig.cap=compareFixed}
wines %>% ggplot(aes(fixed.acidity, color = type)) + geom_density() +
    xlab("Fixed Acidity") + ylab("Density") +
    guides(color = guide_legend("Type")) + theme_minimal()
```

There are attributes where the distributions of values are similar. Figure
`r which(figList == "compareFixed")` shows one example this. The figure shows
distributions of chlorides, separated by wine type. Here we see that both types
of wine share a similar distribution shape. This suggests that this attribute
will not be too helpful in differentiating between the wine types. There are
number of attributes with this pattern: fixed acidity, citric acid, residual
sugar, density, alcohol, quality.

```{r Compare Red/White Cloride, fig.cap=compareChloride}
wines %>% ggplot(aes(chlorides, color = type)) + geom_density() +
    xlab("Chlorides") + ylab("Density") +
    guides(color = guide_legend("Type")) + theme_minimal()
```

However, there are attributes where the distributions are different. An example
of this is shown in Figure `r which(figList == "compareChloride")`. This shows
that we can generally split wine types based on chloride content and this
observation could be exploited. There are number of attributes that have this
pattern: chlorides, volatile acidity, free sulfur dioxide (to a lesser extent),
total sulfur dioxide, pH (to a lesser extent), sulphates (to a lesser extent)

These observations in Figure `r which(figList == "compareFixed")` and Figure
`r which(figList == "compareChloride")` suggest that a learning algorithm will
not have too hard of a time to distinguish between wine type.


## Normality and Skew

I will now take a look at the data to see and note any unusual samples or
attributes. All of our attributes are numerical, except for the wine type. For
simplicity, we will assume and transform our data to as close to a normal
distribution as possible.

```{r Wines pH, fig.cap=figure4}
wines %>% ggplot(aes(pH)) + geom_histogram() + ylab("Count") + theme_minimal()
```

The variables pH and quality appear to be normal enough. Shown in Figure 4
is the distribution of pH values. The distribution appears good enough to be
normal. The values for quality follow a similar distribution.

```{r Wines Citric Acid, fig.cap=figure5}
wines %>% ggplot(aes(citric.acid)) + geom_histogram() +
    ylab("Count") + theme_minimal()
```

There are six attributes which have outliers. These attributes are citric acid
concentration, free sulfur dioxide concentration, total sulfur dioxide, sulfur
dioxide concentration, density, and sulphates concentration. Figure 5 shows a
plot of the citric acid distribution, whereby you can see the bulk of the
distribution and extreme values to the right. The other three attribute with
outliers have similar shapes. Despite having outliers, the overall distribution
of these attributes follows a normal distribution.

```{r Wines Chlorides, fig.cap=figure6}
wines %>% ggplot(aes(chlorides)) + geom_histogram() +
    ylab("Count") + theme_minimal()
```

```{r Wines log(Chlorides), fig.cap=figure7}
wines %>% ggplot(aes(chlorides %>% log)) + geom_histogram() +
    xlab("Chloride Content") + ylab("Count") + theme_minimal()
```

Lastly, there are four attributes which have enough skew in their distribution 
which warrant a transformation. These attributes are fixed acidity, volatile 
acidity, residual sugar content, and chlorides. Figure 6 shows the raw values 
for chloride. The distribution of chloride values is highly skews and will be 
logarithm transformed to take a more normal distribution. The result of a
natural logarithm transformation is shown in Figure 7.

```{r Normalize Data}
wines <- wines %>%
    mutate(fixed.acidity = log(fixed.acidity)) %>%
    mutate(volatile.acidity = log(volatile.acidity)) %>%
    mutate(residual.sugar = log(residual.sugar)) %>%
    mutate(chlorides = log(chlorides))
```


# Methods

## Linear and Logistic Regression

## Decision Trees

## Support Vector Machine

## Naive Bayes Classifier

# Results

## Predict Red and White Wine

I hypothesize that there are enough physicochemical differences between red and
white wines that a learning algorithm will be able to differentiate between the
two.

```{r Predict Red and White Wine, echo=FALSE, results='hide'}
# Decision tree analysis
dtResults <- run_decision_tree_type(wines, "type", "class")

# Naive Bayes analysis
nbResults <- run_naive_bayes(wines, "type")

# SVM analysis
svmResults <- run_svm_type(wines, "type")
```

```{r}

```


## Predict Wine Quality

```{r Predict Wine Quality}
dtQuality <- run_decision_tree_type(wines, "quality", "class")
svmQualityLinear <- run_svm_type(wines, "quality", kernel = "linear")
svmQualityRadial <- run_svm_type(wines, "quality", kernel = "radial")
svmQualityPoly <- run_svm_type(wines, "quality", kernel = "polynomial")
```


# Discussion

# References